@page "/workspace/{project:guid}/vault"
@using Cervantes.CORE
@using Cervantes.CORE.Entities
@using DialogOptions = MudBlazor.DialogOptions
@using Task = System.Threading.Tasks.Task
@using Variant = MudBlazor.Variant
@using Cervantes.CORE.ViewModels
@using Cervantes.Web.Components.Layout
@using Cervantes.Web.Localization
@using Microsoft.Extensions.Localization
@inject IDialogService DialogService
@using TinyMCE.Blazor
@inject IStringLocalizer<Resource> localizer
@layout WorkspaceLayout
@inject NavigationManager navigationManager

<AuthorizeView Context="innerContext" Roles="Admin,SuperUser,User">

<PageTitle>@localizer["dataVault"] | Cervantes</PageTitle>
    <SectionContent SectionName="appbar">
        <MudText Typo="Typo.h5">
            <MudIcon Size="Size.Small" Icon="@Icons.Material.Filled.Workspaces"></MudIcon>

            @localizer["workspace"]

        </MudText>

    </SectionContent>
    <SectionContent SectionName="top-bar">
        <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="0">
            <MudText Typo="Typo.h5">
                <MudIcon Size="Size.Small" Icon="@Icons.Material.Filled.Folder"/> @Project.Name
            </MudText>
            <MudDivider Vertical="true" DividerType="DividerType.Middle" FlexItem="true"></MudDivider>
            <MudText Typo="Typo.h5">
                @localizer["dataVault"]
            </MudText>
        </MudStack>
    </SectionContent>

    <SectionContent SectionName="breadcrumbs">
        <MudBreadcrumbs Items="_items"></MudBreadcrumbs>
    </SectionContent>
<MudGrid>
    <MudItem xs="12" sm="12" md="12">

        <MudDataGrid T="Vault" Items="@model" SortMode="SortMode.Multiple" Filterable="true" QuickFilter="_quickFilter"
                     Hideable="true" Hover="true" RowClick="@RowClicked" MultiSelection="true" SelectedItemsChanged="@SelectedItemsChanged" Virtualize="true" DragDropColumnReordering="true">
            <ToolBarContent>
                <MudStack Row="true">
                    <MudButton Variant="Variant.Filled" StartIcon="@Icons.Material.Filled.Add" Color="Color.Primary" OnClick="@((e) => OpenDialogCreate(maxWidth))">@localizer["create"]</MudButton>
                    @if (seleVaults.Count() != 0)
                    {
                        <MudButtonGroup Color="Color.Primary" Variant="Variant.Outlined">
                            <MudButton>@localizer["actions"]</MudButton>
                            <MudMenu Icon="@Icons.Material.Filled.ArrowDropDown" Style="align-self: auto;">
                                <MudMenuItem OnClick="@((e) => BtnActions(0))">@localizer["delete"]</MudMenuItem>
                            </MudMenu>
                        </MudButtonGroup>
                    }
                </MudStack>
                <MudSpacer/>
                <MudTextField @bind-Value="searchString" Placeholder="@localizer["search"]" Adornment="Adornment.Start" Immediate="true"
                              AdornmentIcon="@Icons.Material.Filled.Search" IconSize="Size.Medium" Class="mt-0">
                </MudTextField>
            </ToolBarContent>
            <Columns>
                <SelectColumn T="Vault"></SelectColumn>
                <PropertyColumn Property="x => x.Name" Title="@localizer["name"]"/>

                <PropertyColumn Property="x => x.Type" Title="@localizer["type"]">
                    <CellTemplate>
                        @switch (@context.Item.Type)
                        {
                            case VaultType.User:
                                <MudChip Icon="@Icons.Material.Filled.Person" Color="Color.Primary">@localizer["user"]</MudChip>
                                break;
                            case VaultType.Password:
                                <MudChip Icon="@Icons.Material.Filled.Password" Color="Color.Success">@localizer["password"]</MudChip>
                                break;
                            case VaultType.Key:
                                <MudChip Icon="@Icons.Material.Filled.Key" Color="Color.Surface">@localizer["key"]</MudChip>
                                break;
                            case VaultType.Note:
                                <MudChip Icon="@Icons.Material.Filled.Note" Color="Color.Secondary">@localizer["note"]</MudChip>
                                break;
                            case VaultType.Other:
                                <MudChip Icon="@Icons.Material.Filled.FileOpen" Color="Color.Tertiary">@localizer["other"]</MudChip>
                                break;
                            case VaultType.Token:
                                <MudChip Icon="@Icons.Material.Filled.VpnKey" Color="Color.Warning">Token</MudChip>
                                break;
                        }

                    </CellTemplate>
                </PropertyColumn>

                <PropertyColumn Property="x => x.User.FullName" Title="@localizer["createdBy"]">
                    <CellTemplate>
                        <MudStack Row="true">
                            @if (@context.Item.User.Avatar != null)
                            {
                                <MudImage Src="@context.Item.User.Avatar" Class="rounded-lg" ObjectFit="ObjectFit.ScaleDown" Height="30" Width="30"/>
                            }
                            else
                            {
                                <MudAvatar Color="Color.Primary" Size="Size.Small">@context.Item.User.FullName[0]</MudAvatar>
                            }
                            <MudStack Justify="Justify.Center" Spacing="0">
                                <MudText Typo="Typo.body1">@context.Item.User.FullName</MudText>
                            </MudStack>
                        </MudStack>

                    </CellTemplate>

                </PropertyColumn>

                <PropertyColumn Property="x => x.CreatedDate" Title="@localizer["createdDate"]">
                    <CellTemplate>
                        <MudStack Row="true">
                            <MudIcon Icon="@Icons.Material.Filled.CalendarToday" Size="Size.Small"/>
                            <MudStack Justify="Justify.Center" Spacing="0">
                                <MudText Typo="Typo.body1">@context.Item.CreatedDate.ToShortDateString()</MudText>
                            </MudStack>
                        </MudStack>

                    </CellTemplate>

                </PropertyColumn>
            </Columns>
            <PagerContent>
                <MudDataGridPager T="Vault"/>
            </PagerContent>
        </MudDataGrid>
     
    </MudItem>
</MudGrid>
</AuthorizeView>