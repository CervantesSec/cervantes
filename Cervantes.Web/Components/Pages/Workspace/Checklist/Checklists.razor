@page "/workspace/{project:guid}/checklist"
@using Cervantes.CORE
@using Cervantes.CORE.Entities
@using Cervantes.CORE.ViewModel
@using DialogOptions = MudBlazor.DialogOptions
@using Task = System.Threading.Tasks.Task
@using Variant = MudBlazor.Variant
@using Cervantes.CORE.ViewModels
@using Cervantes.Web.Components.Layout
@using Cervantes.Web.Localization
@using Microsoft.Extensions.Localization
@using MudBlazor.Extensions.Core
@inject IDialogService DialogService
@using TinyMCE.Blazor
@inject IStringLocalizer<Resource> localizer
@layout WorkspaceLayout
@inject NavigationManager navigationManager
@inject IMudExDialogService DialogEx


<AuthorizeView Context="innerContext" Roles="Admin,SuperUser,User">

<PageTitle>@localizer["checklist"] | Cervantes</PageTitle>
    <SectionContent SectionName="appbar">
        <MudText Typo="Typo.h5">
            <MudIcon Size="Size.Small" Icon="@Icons.Material.Filled.Workspaces"></MudIcon>

            @localizer["workspace"]

        </MudText>
    </SectionContent>
    <SectionContent SectionName="top-bar">
        <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="0">
            <MudText Typo="Typo.h5">
                <MudIcon Size="Size.Small" Icon="@Icons.Material.Filled.Folder"/> @Project.Name
            </MudText>
            <MudDivider Vertical="true" DividerType="DividerType.Middle" FlexItem="true"></MudDivider>
            <MudText Typo="Typo.h5">
                @localizer["checklist"]
            </MudText>
        </MudStack>
    </SectionContent>

    <SectionContent SectionName="breadcrumbs">
        <MudBreadcrumbs Items="_items"></MudBreadcrumbs>
    </SectionContent>
    
        <MudGrid>
        <MudItem xs="12" sm="12" md="12">
        
            <MudDataGrid T="ChecklistViewModel" Items="@model" SortMode="SortMode.Multiple" Filterable="true" QuickFilter="_quickFilter"
                         Hideable="true" Hover="true" RowClick="@RowClicked" MultiSelection="true" SelectedItemsChanged="@SelectedItemsChanged" Virtualize="true" DragDropColumnReordering="true">
                <ToolBarContent>
                    <MudStack Row="true">
                        <MudButton Variant="Variant.Filled" StartIcon="@Icons.Material.Filled.Add" Color="Color.Primary" OnClick="@((e) => OpenDialogCreate(maxWidth))">@localizer["create"]</MudButton>
                         @if (seleChecklists.Count() != 0)
                                                {
                                                    <MudButtonGroup Color="Color.Primary" Variant="Variant.Outlined" >
                                                        <MudButton>@localizer["actions"]</MudButton>
                                                        <MudMenu Icon="@Icons.Material.Filled.ArrowDropDown" Style="align-self: auto;">
                                                            <MudMenuItem OnClick="@((e) => BtnActions(0))">@localizer["delete"]</MudMenuItem>
                                                        </MudMenu>
                                                    </MudButtonGroup>
                                                }
                    </MudStack>
                    <MudSpacer/>
                    <MudTextField @bind-Value="searchString" Placeholder="@localizer["search"]" Adornment="Adornment.Start" Immediate="true"
                                  AdornmentIcon="@Icons.Material.Filled.Search" IconSize="Size.Medium" Class="mt-0"></MudTextField>
                </ToolBarContent>
                <Columns>
                    <SelectColumn T="ChecklistViewModel"></SelectColumn>
                    <PropertyColumn Property="x => x.Target" Title="@localizer["name"]"/>
                    <PropertyColumn Property="x => x.Type" Title="@localizer["type"]"/>
                    <PropertyColumn Property="x => x.CreatedDate.ToShortDateString()" Title="@localizer["createdDate"]"/>
                    
                    <PropertyColumn Property="x => x.User" Title="@localizer["createdBy"]"/>
                </Columns>
                <PagerContent>
                    <MudDataGridPager T="ChecklistViewModel"/>
                </PagerContent>
            </MudDataGrid>
            
        </MudItem>
        </MudGrid>
</AuthorizeView>